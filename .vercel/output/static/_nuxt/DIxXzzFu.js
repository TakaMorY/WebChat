import{p as n,q as _,c as d,a as s,B as C,f as S,y as t,t as w,s as U,v as p,x,z as P,C as E,A as T,o as i}from"./rPPG3L9u.js";import{u as z}from"./BOwVLIuv.js";const B={class:"min-h-screen bg-gray-50 py-8"},H={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},N={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},F={class:"lg:col-span-1"},R={class:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6"},q={class:"text-center"},G={class:"relative inline-block"},I=["src"],J={class:"text-xl font-semibold text-gray-900 mt-4"},K={class:"text-gray-600"},O={class:"text-sm text-gray-500 mt-2"},Q={class:"lg:col-span-2 space-y-6"},W={class:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Y=["disabled"],Z={key:0},ss={key:1},es={class:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6"},ts=["type"],os=["type"],rs=["type"],as=["disabled"],ls={key:0},ns={key:1},ds={class:"bg-white rounded-2xl shadow-sm border border-red-200 p-6"},is={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},us={class:"bg-white rounded-2xl p-6 max-w-md w-full mx-4"},ps={class:"space-y-4"},cs={class:"flex justify-end space-x-3"},ms=["disabled"],bs={key:0},fs={key:1},xs={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},gs={class:"bg-white rounded-2xl p-6 max-w-md w-full mx-4"},ys={class:"mb-4"},vs={class:"flex justify-end space-x-3"},ws=["disabled"],hs={key:0},ks={key:1},Us={__name:"profile",setup(_s){const g=z(),r=n(g.user),y=n(!1),h=n(!1),c=n(!1),m=n(!1),b=n(!1),f=n(!1),u=_({name:r.value?.name||"",secondname:r.value?.secondname||"",email:r.value?.email||""}),a=_({currentPassword:"",newPassword:"",confirmPassword:""}),k=_({url:r.value?.avatar_url||""}),v=n(""),V=n(!1),$=n(!1),M=n(!1);async function j(){if(!c.value){c.value=!0;try{const l=await $fetch(`/api/users/${r.value.id}`,{method:"PATCH",body:{name:u.name,secondname:u.secondname}});g.user=l,r.value=l,alert("Профиль успешно обновлен!")}catch(l){alert(l.data?.statusMessage||"Ошибка при обновлении профиля")}finally{c.value=!1}}}async function A(){if(!m.value){if(a.newPassword!==a.confirmPassword){alert("Новые пароли не совпадают");return}if(a.newPassword.length<6){alert("Новый пароль должен содержать минимум 6 символов");return}m.value=!0;try{await $fetch(`/api/users/${r.value.id}/password`,{method:"PATCH",body:{currentPassword:a.currentPassword,newPassword:a.newPassword}}),a.currentPassword="",a.newPassword="",a.confirmPassword="",alert("Пароль успешно изменен!")}catch(l){alert(l.data?.statusMessage||"Ошибка при смене пароля")}finally{m.value=!1}}}async function D(){if(!b.value){b.value=!0;try{const l=await $fetch(`/api/users/${r.value.id}`,{method:"PATCH",body:{avatar_url:k.url}});g.user=l,r.value=l,y.value=!1,alert("Аватар успешно обновлен!")}catch(l){alert(l.data?.statusMessage||"Ошибка при обновлении аватара")}finally{b.value=!1}}}async function L(){if(!f.value){f.value=!0;try{await $fetch(`/api/users/${r.value.id}`,{method:"DELETE"}),await g.logout(),await T("/"),alert("Аккаунт успешно удален")}catch(l){alert(l.data?.statusMessage||"Ошибка при удалении аккаунта")}finally{f.value=!1}}}return(l,e)=>(i(),d("div",B,[s("div",H,[e[25]||(e[25]=s("div",{class:"mb-8"},[s("h1",{class:"text-3xl font-bold text-gray-900"},"Профиль пользователя"),s("p",{class:"text-gray-600 mt-2"},"Управление вашей учетной записью")],-1)),s("div",N,[s("div",F,[s("div",R,[s("div",q,[s("div",G,[s("img",{src:t(r).avatar_url||"/default-avatar.png",alt:"Аватар",class:"w-32 h-32 rounded-full mx-auto border-4 border-purple-100 object-cover"},null,8,I),s("button",{onClick:e[0]||(e[0]=o=>y.value=!0),class:"absolute bottom-0 right-0 bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600 transition-colors"},[...e[12]||(e[12]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])])]),s("h2",J,w(t(r).name)+" "+w(t(r).secondname),1),s("p",K,w(t(r).email),1),s("p",O," Участник с "+w(new Date(t(r).created_at).toLocaleDateString("ru-RU")),1)]),e[13]||(e[13]=S('<div class="mt-6 space-y-3"><div class="flex justify-between text-sm"><span class="text-gray-600">Статус</span><span class="text-green-600 font-medium">Активен</span></div><div class="flex justify-between text-sm"><span class="text-gray-600">Последний вход</span><span class="text-gray-900">Сегодня</span></div></div>',1))])]),s("div",Q,[s("div",W,[e[18]||(e[18]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Основная информация",-1)),s("form",{onSubmit:U(j,["prevent"]),class:"space-y-4"},[s("div",X,[s("div",null,[e[14]||(e[14]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Имя",-1)),p(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>t(u).name=o),class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[x,t(u).name]])]),s("div",null,[e[15]||(e[15]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Фамилия",-1)),p(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>t(u).secondname=o),class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[x,t(u).secondname]])])]),s("div",null,[e[16]||(e[16]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email",-1)),p(s("input",{type:"email","onUpdate:modelValue":e[3]||(e[3]=o=>t(u).email=o),class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:""},null,512),[[x,t(u).email]]),e[17]||(e[17]=s("p",{class:"text-sm text-gray-500 mt-1"},"Email нельзя изменить",-1))]),s("button",{type:"submit",disabled:t(c),class:"bg-purple-500 text-white px-6 py-3 rounded-xl hover:bg-purple-600 transition-colors disabled:opacity-50"},[t(c)?(i(),d("span",Z,"Сохранение...")):(i(),d("span",ss,"Сохранить изменения"))],8,Y)],32)]),s("div",es,[e[22]||(e[22]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Смена пароля",-1)),s("form",{onSubmit:U(A,["prevent"]),class:"space-y-4"},[s("div",null,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Текущий пароль",-1)),p(s("input",{type:t(V)?"text":"password","onUpdate:modelValue":e[4]||(e[4]=o=>t(a).currentPassword=o),class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,8,ts),[[P,t(a).currentPassword]])]),s("div",null,[e[20]||(e[20]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Новый пароль",-1)),p(s("input",{type:t($)?"text":"password","onUpdate:modelValue":e[5]||(e[5]=o=>t(a).newPassword=o),class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,8,os),[[P,t(a).newPassword]])]),s("div",null,[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Подтвердите новый пароль",-1)),p(s("input",{type:t(M)?"text":"password","onUpdate:modelValue":e[6]||(e[6]=o=>t(a).confirmPassword=o),class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,8,rs),[[P,t(a).confirmPassword]])]),s("button",{type:"submit",disabled:t(m),class:"bg-purple-500 text-white px-6 py-3 rounded-xl hover:bg-purple-600 transition-colors disabled:opacity-50"},[t(m)?(i(),d("span",ls,"Смена пароля...")):(i(),d("span",ns,"Сменить пароль"))],8,as)],32)]),s("div",ds,[e[23]||(e[23]=s("h3",{class:"text-lg font-semibold text-red-700 mb-4"},"Опасная зона",-1)),e[24]||(e[24]=s("p",{class:"text-gray-600 mb-4"},"Удаление аккаунта невозможно отменить. Все ваши данные будут безвозвратно удалены.",-1)),s("button",{onClick:e[7]||(e[7]=o=>h.value=!0),class:"bg-red-500 text-white px-6 py-3 rounded-xl hover:bg-red-600 transition-colors"}," Удалить аккаунт ")])])])]),t(y)?(i(),d("div",is,[s("div",us,[e[27]||(e[27]=s("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Смена аватара",-1)),s("div",ps,[s("div",null,[e[26]||(e[26]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"URL аватара",-1)),p(s("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=o=>t(k).url=o),placeholder:"https://example.com/avatar.jpg",class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[x,t(k).url]])]),s("div",cs,[s("button",{onClick:e[9]||(e[9]=o=>y.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"}," Отмена "),s("button",{onClick:D,disabled:t(b),class:"bg-purple-500 text-white px-6 py-2 rounded-xl hover:bg-purple-600 transition-colors disabled:opacity-50"},[t(b)?(i(),d("span",bs,"Сохранение...")):(i(),d("span",fs,"Сохранить"))],8,ms)])])])])):C("",!0),t(h)?(i(),d("div",xs,[s("div",gs,[e[29]||(e[29]=s("h3",{class:"text-lg font-semibold text-red-700 mb-4"},"Удаление аккаунта",-1)),e[30]||(e[30]=s("p",{class:"text-gray-600 mb-4"},"Вы уверены, что хотите удалить свой аккаунт? Это действие нельзя отменить.",-1)),s("div",ys,[e[28]||(e[28]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},' Введите "УДАЛИТЬ" для подтверждения ',-1)),p(s("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=o=>E(v)?v.value=o:null),class:"w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"},null,512),[[x,t(v)]])]),s("div",vs,[s("button",{onClick:e[11]||(e[11]=o=>h.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"}," Отмена "),s("button",{onClick:L,disabled:t(v)!=="УДАЛИТЬ"||t(f),class:"bg-red-500 text-white px-6 py-2 rounded-xl hover:bg-red-600 transition-colors disabled:opacity-50"},[t(f)?(i(),d("span",hs,"Удаление...")):(i(),d("span",ks,"Удалить аккаунт"))],8,ws)])])])):C("",!0)]))}};export{Us as default};
